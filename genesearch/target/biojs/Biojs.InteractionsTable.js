
Biojs.InteractionsTable=Biojs.Table.extend({constructor:function(options){this._useVersion(options.dataSet.version|Biojs.InteractionsTable.MITAB_VERSION_2_5_EXT);this.base(options);},opt:{target:"YourOwnDivId",rowSelection:false,version:"MITAB_VERSION_2_5_EXT",psiquicUrl:'http://www.ebi.ac.uk/Tools/webservices/psicquic/intact/webservices/current/search/query',proxyUrl:'../biojs/dependencies/proxy/proxy.php'},eventTypes:[],setQuery:function(query){delete this.opt.dataSet.url;delete this.opt.totalRecords;this.opt.dataSet.query=query;this.setDataSource(this.opt.dataSet);},getQuery:function(){return unescape(this.opt.dataSet.query);},_requestQueryCount:function(dataSet,action){var self=this;dataSet.url=dataSet.psicquicUrl+'/'+dataSet.query;dataSet.paramsMap={"iDisplayStart":"firstResult","iDisplayLength":"maxResults"};jQuery.ajax({url:dataSet.proxyUrl,dataType:"text",data:[{name:"url",value:dataSet.url+'?format=count'}],success:function(data){dataSet.totalRecords=parseInt(data)|0;action.call(self,dataSet);}});},setDataSource:function(dataSet){if(dataSet instanceof Array){this.base(dataSet);}else{if(dataSet.hasOwnProperty("totalRecords")&&dataSet.hasOwnProperty("url")){this.base(dataSet);}else{this.opt.dataSet={};this.opt.dataSet.psicquicUrl=dataSet.psicquicUrl;this.opt.dataSet.proxyUrl=dataSet.proxyUrl;this.opt.dataSet.version=dataSet.version;this.opt.dataSet.filter=dataSet.filter;this.opt.dataSet.query=escape(dataSet.query);this.opt.dataSet.url=dataSet.psicquicUrl+'/'+dataSet.query;this.opt.dataSet.paramsMap={"iDisplayStart":"firstResult","iDisplayLength":"maxResults"};this._requestQueryCount(this.opt.dataSet,this.base);}}},_decodeToJSON:function(mitabData){Biojs.console.log("DATA DECODING FROM MITAB to JSON");var jsonData={};var decoder=new Biojs.InteractionsTable.MITabTxtDecoder(mitabData);jsonData.aaData=decoder.decodeData();jsonData.iTotalRecords=this.getTotalRecords();jsonData.iTotalDisplayRecords=this.getTotalRecords();delete decoder;return jsonData;},_useVersion:function(version){var length=((typeof version)=="string")?Biojs.InteractionsTable[version]:version;var columnsToHide=[];switch(length){case Biojs.InteractionsTable.MITAB_VERSION_2_7:for(var i=36;i<42;i++){this.opt.columns[i]=Biojs.InteractionsTable.MITAB_COLUMNS[i];}
columnsToHide=[36,37,38,39,40,41];case Biojs.InteractionsTable.MITAB_VERSION_2_6:for(var i=31;i<36;i++){this.opt.columns[i]=Biojs.InteractionsTable.MITAB_COLUMNS[i];}
columnsToHide=columnsToHide.concat([31,32,33,34,35]);case Biojs.InteractionsTable.MITAB_VERSION_2_5_EXT:for(var i=15;i<31;i++){this.opt.columns[i]=Biojs.InteractionsTable.MITAB_COLUMNS[i];}
columnsToHide=columnsToHide.concat([15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]);this.opt.columns[15].render=this._columnRender.showDescXRef;this.opt.columns[16].render=this._columnRender.showDescXRef;this.opt.columns[17].render=this._columnRender.showDescXRef;this.opt.columns[18].render=this._columnRender.showRowDescXRef;this.opt.columns[19].render=this._columnRender.showRowDescXRef;this.opt.columns[20].render=this._columnRender.showDescXRef;this.opt.columns[21].render=this._columnRender.showDescXRef;this.opt.columns[22].render=this._columnRender.showDescXRef;this.opt.columns[23].render=this._columnRender.showDescXRef;this.opt.columns[24].render=this._columnRender.showDescXRef;this.opt.columns[25].render=this._columnRender.showRowDescXRef;this.opt.columns[26].render=this._columnRender.showRowDescXRef;this.opt.columns[27].render=this._columnRender.showRowDescXRef;this.opt.columns[28].render=this._columnRender.showDescXRef;this.opt.columns[29].render=this._columnRender.showRowDescXRef;this.opt.columns[30].render=this._columnRender.showRowDescXRef;case Biojs.InteractionsTable.MITAB_VERSION_2_5:for(var i=0;i<15;i++){this.opt.columns[i]=Biojs.InteractionsTable.MITAB_COLUMNS[i];}
columnsToHide=columnsToHide.concat([2,3,7,8,11,12,13]);this.opt.columns[0].render=this._columnRender.showProteinXRef;this.opt.columns[1].render=this._columnRender.showProteinXRef;this.opt.columns[2].render=this._columnRender.showValueXRef;this.opt.columns[3].render=this._columnRender.showValueXRef;this.opt.columns[4].render=this._columnRender.showValueXRef;this.opt.columns[5].render=this._columnRender.showValueXRef;this.opt.columns[6].render=this._columnRender.showDescXRef;this.opt.columns[9].render=this._columnRender.showDescXRef;this.opt.columns[10].render=this._columnRender.showDescXRef;this.opt.columns[11].render=this._columnRender.showDescXRef;this.opt.columns[12].render=this._columnRender.showDescXRef;this.opt.columns[13].render=this._columnRender.showInteractionXRef;this.opt.columns[14].render=this._columnRender.showRawValueXRef;break;default:Biojs.console.log("Wrong version <"+length+"> ");}
this.opt.hideColumns=columnsToHide;},_columnRender:{showProteinXRef:function(col,dataRow,currentValue){var tk=new Biojs.InteractionsTable.MITabTxtDecoder(currentValue);var newValue="";var xref={};while(tk.hasNext()){xref=tk.decodeXRef();url=Biojs.InteractionsTable.DATABASE_URL[xref.key];newValue+='<a href="'+url+xref.value+'" title="'+xref.desc+'" >'+xref.value+'</a><br/>';}
delete tk;return newValue;},showInteractionXRef:function(col,dataRow,currentValue){var tk=new Biojs.InteractionsTable.MITabTxtDecoder(currentValue);var newValue="";var xref={};while(tk.hasNext()){xref=tk.decodeXRef();url=Biojs.InteractionsTable.DATABASE_URL[xref.key];newValue+='<a href="'+url+'interaction/'+xref.value+'" title="'+xref.desc+'" >'+xref.value+'</a><br/>';}
delete tk;return newValue;},showValueXRef:function(col,dataRow,currentValue){var tk=new Biojs.InteractionsTable.MITabTxtDecoder(currentValue);var newValue="";var comma="";var xref;while(tk.hasNext()){xref=tk.decodeXRef();newValue+=comma+'<span title="'+xref.desc+'">'+xref.value+'</span>';comma=', ';}
delete tk;return newValue;},showDescXRef:function(col,dataRow,currentValue){var tk=new Biojs.InteractionsTable.MITabTxtDecoder(currentValue);var newValue="";while(tk.hasNext()){xref=tk.decodeXRef();url=Biojs.InteractionsTable.DATABASE_URL[xref.key.replace(/-/gi,'')];newValue+='<a href="'+url+xref.value+'" >'+xref.desc+'</a><br/>';}
delete tk;return newValue;},showRawValueXRef:function(col,dataRow,currentValue){var tk=new Biojs.InteractionsTable.MITabTxtDecoder(currentValue);var newValue="";if(tk.hasNext()){xref=tk.decodeXRef();newValue=xref.value;}
delete tk;return newValue;},showRowDescXRef:function(col,dataRow,currentValue){var tk=new Biojs.InteractionsTable.MITabTxtDecoder(currentValue);var newValue="";var comma="";while(tk.hasNext()){xref=tk.decodeXRef();newValue+=comma+xref.desc;comma=", ";}
delete tk;return newValue;}}},{MITabTxtDecoder:function(str){this.buffer=(str!=undefined)?str:"";this.offset=0;this.nextToken=function(delimiter){var token="";var index;if(this.offset<this.buffer.length){start=this.offset;index=this.buffer.indexOf(delimiter,start);if(index!=-1){this.offset=index;token=this.buffer.substring(start,index);this.offset+=delimiter.length;}else{this.offset=this.buffer.length;token=this.buffer.substring(start);}}else{}
return token;}
this.hasNext=function(){return this.offset<this.buffer.length;}
this.decodeXRef=function(){var token="";var xref={key:"",value:"",desc:""};token=this.nextToken(":");if(token.length>1){xref.key=token;xref.value=this.nextToken("|").replace(/\"/gi,'');descIdx=xref.value.indexOf("(");if(descIdx!=-1){xref.desc=xref.value.substring(descIdx+1,xref.value.length-1);xref.value=xref.value.substring(0,descIdx);}
Biojs.console.log("XREF<"+xref.key+">, VALUE<"+xref.value+">, DESC<"+xref.desc+">");}
return xref;}
this.decodeRow=function(){var row=[];if(this.hasNext()){row=this.nextToken("\n").split("\t");}
return row;}
this.decodeData=function(){var data=[];while(this.hasNext()){data.push(this.decodeRow());}
return data;}},MITAB_VERSION_2_5:15,MITAB_VERSION_2_5_EXT:31,MITAB_VERSION_2_6:36,MITAB_VERSION_2_7:42,MITAB_COLUMNS:[{name:"Identifier A"},{name:"Identifier B"},{name:"Alternative id A"},{name:"Alternative id B"},{name:"Aliases for A"},{name:"Aliases for B"},{name:"Detection Method"},{name:"first author"},{name:"Id of publication"},{name:"NCBI taxon A"},{name:"NCBI taxon B"},{name:"Interaction type"},{name:"Source"},{name:"Interaction identifier(s)"},{name:"Confidence score"},{name:"Complex expansion"},{name:"Biological role A"},{name:"Biological role B"},{name:"Experimental role A"},{name:"Experimental role B"},{name:"Interactor type A"},{name:"Interactor type B"},{name:"Xref for interactor A"},{name:"Xref for interactor B"},{name:"Xref for the interaction"},{name:"Annotations for interactor A"},{name:"Annotations for Interactor B"},{name:"Annotations for the interaction"},{name:"NCBI Taxonomy identifier for the host organism"},{name:"Parameters of the interaction"},{name:"Creation date"},{name:"Update date"},{name:"Checksum for interactor A"},{name:"Checksum for interactor B"},{name:"Checksum for interaction"},{name:"negative"},{name:"Binding domain for interactor A"},{name:"Binding domain for interactor B"},{name:"Stoichiometry for interactor A"},{name:"Stoichiometry for interactor B"},{name:"Participant identification method for interactor A"},{name:"Participant identification method for interactor B"}],DATABASE_URL:{uniprotkb:'http://www.uniprot.org/uniprot/',intact:'http://www.ebi.ac.uk/intact/',taxid:'http://www.uniprot.org/taxonomy/',psimi:'http://www.ebi.ac.uk/ontology-lookup/browse.do?ontName=MI&termId='}});