
Biojs.PDBLogos=Biojs.extend({opt:{target:"YourOwnDivId",raphael:null,identifier:"",startX:10,startY:10,interval:10,size:40,orient:'h',logosURL:'http://www.ebi.ac.uk/pdbe-apps/widgets/pdbprints',logos:[],color:"#588FE5",pdb3DIcon:'biojs/css/images/3d.png'},eventTypes:["onClick"],constructor:function(options){this._initCanvas();if(!Biojs.Utils.isEmpty(this.opt.identifier)){this._doRequest(this.opt.identifier);}},_initCanvas:function(){var config=this.opt;if(!Biojs.Utils.isEmpty(config.raphael)){config.raphael.remove();config.raphael=null;}
var sizex=config.startX+config.size*Biojs.PDBLogos.CATEGORY.lenght;var sizey=config.startY+(config.interval+config.size);if(config.orient==Biojs.PDBLogos.VERTICAL){sizey=config.startY+config.size*Biojs.PDBLogos.CATEGORY.lenght;sizex=config.startX+(config.interval+config.size);}
config.raphael=Raphael(config.target,sizex,sizey);},setIdentifier:function(value){this.opt.identifier=value;this._initCanvas();this._doRequest(value);},_doRequest:function(identifier){var self=this;jQuery.ajax({url:'http://www.ebi.ac.uk/pdbe-apps/widgets/pdbprints',data:{'varname':'printsdata','pdbid':identifier,color:"transparent"},dataType:'script',crossDomain:'true',type:'GET',success:function(response,callOptions){self._printsLayout(printsdata);}});},_printsLayout:function(data){var self=this;var config=this.opt;var ix=config.startX;var iy=config.startY;var i=0;config.logos=[];data[config.identifier].PDBStructure=[config.pdb3DIcon,'structure'];for(category in Biojs.PDBLogos.CATEGORY){var isizeY=config.size,isizeX=config.size;var imgUrl=data[config.identifier][category][0];var printsURL="http://www.pdbe.org";ix=config.startX;iy=config.startY;if(config.orient==Biojs.PDBLogos.VERTICAL){iy+=config.size*(i++);}else{ix+=config.size*(i++);}
if(category=="PDBeLogo"){config.logos.push(config.raphael.text(ix,iy+self.opt.size/4,config.identifier).attr({'font-family':'Mono','text-anchor':'start','font-size':self.opt.size/3,'cursor':'pointer','title':'View all about PDB '+config.identifier}).data("identifier",config.identifier).mouseup(function(){window.open("http://www.pdbe.org/"+this.data("identifier"));}));imgUrl="http://www.ebi.ac.uk/pdbe-apps/widgets/html/PDBeWatermark_horizontal_128.png";isizeX=config.size*0.9;isizeY=config.size/2;iy+=config.size/2;}else{printsURL+="/"+config.identifier+"/"+Biojs.PDBLogos.CATEGORY[category];if(category=="PDBStructure"){printsURL="http://www.ebi.ac.uk/pdbe-srv/view/entry/"+config.identifier+"/openastex";}
config.raphael.rect(ix,iy,isizeX,isizeY,7).attr({'fill':self.opt.color});}
config.logos.push(config.raphael.image(imgUrl,ix,iy,isizeX,isizeY).attr({'cursor':'pointer','title':'View '+category}).data({"printsURL":printsURL,"category":category}).mouseup(function(){self.raiseEvent(Biojs.PDBLogos.EVT_ON_CLICK,{printsURL:this.data("printsURL"),identifier:config.identifier,category:this.data("category")});}).mouseover(function(){}));}}},{HORIZONTAL:'h',VERTICAL:'v',CATEGORY:{"PDBeLogo":"","PrimaryCitation":"citation","Taxonomy":"taxonomy","Expressed":"taxonomy","Experimental":"experimental","Protein":"primary","NucleicAcid":"primary","Ligands":"ligands","PDBStructure":"PDBStructure"},EVT_ON_CLICK:"onClick"});